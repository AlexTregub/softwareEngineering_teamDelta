<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Error Detection Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .error { color: red; font-weight: bold; }
        .success { color: green; }
        .warning { color: orange; }
        pre { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Error Detection Test</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function checkClass(className, scriptPath) {
            try {
                if (typeof window[className] !== 'undefined') {
                    log(`‚úÖ ${className} is available`, 'success');
                    return true;
                } else {
                    log(`‚ùå ${className} is NOT available (loaded from ${scriptPath})`, 'error');
                    return false;
                }
            } catch (error) {
                log(`‚ùå Error checking ${className}: ${error.message}`, 'error');
                return false;
            }
        }

        // Capture all errors
        window.addEventListener('error', function(e) {
            log(`‚ùå JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            log(`‚ùå Unhandled Promise Rejection: ${e.reason}`, 'error');
        });

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            log('üîÑ Starting error detection test...', 'info');
            
            setTimeout(function() {
                log('üìã Checking class availability:', 'info');
                
                // Check core classes first
                checkClass('ant', 'Classes/ants/ants.js');
                checkClass('Job', 'Classes/ants/Job.js');
                checkClass('AntStateMachine', 'Classes/ants/antStateMachine.js');
                
                // Check controller classes
                checkClass('MovementController', 'Classes/systems/MovementController.js');
                checkClass('TaskManager', 'Classes/systems/TaskManager.js');
                checkClass('RenderController', 'Classes/systems/RenderController.js');
                
                // Check manager classes
                checkClass('GameStateManager', 'Classes/managers/GameStateManager.js');
                
                // Test creating an ant if classes are available
                if (typeof ant !== 'undefined' && typeof MovementController !== 'undefined') {
                    try {
                        log('üß™ Testing ant creation with controllers...', 'info');
                        const testAnt = new ant(100, 100, 20, 20, 30, 0);
                        
                        if (testAnt._movementController) {
                            log('‚úÖ Ant created with MovementController', 'success');
                        } else {
                            log('‚ö†Ô∏è Ant created but MovementController is null', 'warning');
                        }
                        
                        if (testAnt._taskManager) {
                            log('‚úÖ Ant created with TaskManager', 'success');
                        } else {
                            log('‚ö†Ô∏è Ant created but TaskManager is null', 'warning');
                        }
                        
                        if (testAnt._renderController) {
                            log('‚úÖ Ant created with RenderController', 'success');
                        } else {
                            log('‚ö†Ô∏è Ant created but RenderController is null', 'warning');
                        }
                        
                        // Test basic functionality
                        const moveResult = testAnt.moveToLocation(200, 150);
                        if (moveResult) {
                            log('‚úÖ moveToLocation works', 'success');
                        } else {
                            log('‚ö†Ô∏è moveToLocation returned false', 'warning');
                        }
                        
                    } catch (error) {
                        log(`‚ùå Error creating test ant: ${error.message}`, 'error');
                        log(`Stack trace: ${error.stack}`, 'error');
                    }
                } else {
                    log('‚ùå Cannot test ant creation - required classes not available', 'error');
                }
                
                log('‚úÖ Error detection test completed', 'success');
            }, 100); // Small delay to let all scripts load
        });
    </script>

    <!-- Load essential scripts in order -->
    <script src="libraries/p5.min.js"></script>
    <script src="Classes/entities/sprite2d.js"></script>
    <script src="Classes/entities/StatsContainer.js"></script>
    <script src="Classes/ants/antStateMachine.js"></script>
    <script src="Classes/systems/ResourceManager.js"></script>
    <script src="Classes/managers/GameStateManager.js"></script>
    <script src="Classes/systems/MovementController.js"></script>
    <script src="Classes/systems/TaskManager.js"></script>
    <script src="Classes/systems/RenderController.js"></script>
    <script src="Classes/ants/ants.js"></script>
    <script src="Classes/ants/Job.js"></script>
</body>
</html>