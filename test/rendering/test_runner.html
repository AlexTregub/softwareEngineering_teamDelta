<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rendering System Tests</title>
    
    <!-- Mocha CSS for test output styling -->
    <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css">
    
    <!-- p5.js for rendering context -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    
    <!-- Mocha and Chai for testing -->
    <script src="https://unpkg.com/mocha@10.2.0/mocha.js"></script>
    <script src="https://unpkg.com/chai@4.3.10/chai.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        .test-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007ACC;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #005a99;
        }
        
        #test-output {
            margin-top: 20px;
            min-height: 300px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        
        .success { color: green; }
        .failure { color: red; }
        .pending { color: orange; }
    </style>
</head>
<body>
    <h1>ðŸ§ª Rendering System Behavioral Tests</h1>
    
    <div class="test-controls">
        <h3>Test Categories</h3>
        <button onclick="runEntityAccessTests()">Entity Access Tests</button>
        <button onclick="runRenderControllerTests()">RenderController Tests</button>
        <button onclick="runEntityRendererTests()">EntityRenderer Tests</button>
        <button onclick="runPerformanceTests()">Performance Tests</button>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div id="mocha"></div>
    <div id="test-output"></div>
    
    <!-- Load our rendering system files -->
    <script src="../EntityAccessor.js"></script>
    <script src="../RenderController.js"></script>
    <script src="../EntityLayerRenderer.js"></script>
    <script src="../PerformanceMonitor.js"></script>
    
    <!-- Load test suites -->
    <script src="specs/entity_access_spec.js"></script>
    <script src="specs/render_controller_spec.js"></script>
    <script src="specs/entity_renderer_spec.js"></script>
    <script src="specs/performance_spec.js"></script>
    
    <script>
        // Configure Mocha
        mocha.setup('bdd');
        const expect = chai.expect;
        
        // Mock p5.js globals for testing
        window.createVector = function(x, y) {
            return { x: x, y: y, copy: function() { return createVector(this.x, this.y); } };
        };
        
        window.performance = window.performance || { now: function() { return Date.now(); } };
        
        // Test runner functions
        function runEntityAccessTests() {
            mocha.grep('EntityAccessor').run();
        }
        
        function runRenderControllerTests() {
            mocha.grep('RenderController').run();
        }
        
        function runEntityRendererTests() {
            mocha.grep('EntityRenderer').run();
        }
        
        function runPerformanceTests() {
            mocha.grep('Performance').run();
        }
        
        function runAllTests() {
            mocha.run();
        }
        
        function clearResults() {
            document.getElementById('mocha').innerHTML = '';
        }
        
        // Initialize p5.js in instance mode to avoid conflicts
        let testSketch = function(p) {
            p.setup = function() {
                // Minimal p5 setup for testing
                let canvas = p.createCanvas(100, 100);
                canvas.parent('test-output');
            };
            
            p.draw = function() {
                // Don't need continuous drawing for tests
                p.noLoop();
            };
        };
        
        // Create p5 instance
        new p5(testSketch);
        
        console.log("Test environment initialized. Click buttons to run tests.");
    </script>
</body>
</html>