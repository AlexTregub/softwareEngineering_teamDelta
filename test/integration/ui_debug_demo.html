<!DOCTYPE html>
<html>
<head>
    <title>UI Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        canvas { border: 1px solid #ccc; }
        .instructions { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ðŸŽ¯ UI Debug System Test</h1>
    <div class="instructions">
        <strong>Instructions:</strong>
        <ol>
            <li>Press <kbd>~</kbd> (tilde) or <kbd>`</kbd> (backtick) to toggle debug mode</li>
            <li>When debug mode is ON, you'll see yellow drag handles on UI elements</li>
            <li>Click and drag the yellow handles to move UI elements</li>
            <li>Positions are automatically saved to localStorage</li>
        </ol>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="Classes/rendering/UIDebugManager.js"></script>
    
    <script>
        // Global debug manager
        let g_uiDebugManager;
        
        // Sample UI elements (simulated)
        let testElements = {
            button1: { x: 100, y: 50, width: 120, height: 40, label: "Save Game" },
            button2: { x: 250, y: 50, width: 120, height: 40, label: "Load Game" },
            panel: { x: 50, y: 150, width: 200, height: 100, label: "Debug Panel" }
        };
        
        function setup() {
            createCanvas(800, 600);
            
            // Initialize UI Debug Manager
            g_uiDebugManager = new UIDebugManager();
            
            // Register test elements
            g_uiDebugManager.registerElement('test-button-1', testElements.button1, 
                (newPos) => { testElements.button1.x = newPos.x; testElements.button1.y = newPos.y; },
                { label: 'Save Button', draggable: true }
            );
            
            g_uiDebugManager.registerElement('test-button-2', testElements.button2,
                (newPos) => { testElements.button2.x = newPos.x; testElements.button2.y = newPos.y; },
                { label: 'Load Button', draggable: true }
            );
            
            g_uiDebugManager.registerElement('test-panel', testElements.panel,
                (newPos) => { testElements.panel.x = newPos.x; testElements.panel.y = newPos.y; },
                { label: 'Debug Panel', draggable: true }
            );
            
            console.log('UI Debug System initialized. Press ~ or ` to toggle debug mode.');
        }
        
        function draw() {
            background(220);
            
            // Draw test UI elements
            stroke(0);
            strokeWeight(2);
            
            // Button 1
            fill(100, 150, 255);
            rect(testElements.button1.x, testElements.button1.y, testElements.button1.width, testElements.button1.height);
            fill(255);
            textAlign(CENTER, CENTER);
            text(testElements.button1.label, 
                testElements.button1.x + testElements.button1.width/2, 
                testElements.button1.y + testElements.button1.height/2);
            
            // Button 2
            fill(255, 150, 100);
            rect(testElements.button2.x, testElements.button2.y, testElements.button2.width, testElements.button2.height);
            fill(255);
            text(testElements.button2.label,
                testElements.button2.x + testElements.button2.width/2,
                testElements.button2.y + testElements.button2.height/2);
            
            // Panel
            fill(150, 255, 150);
            rect(testElements.panel.x, testElements.panel.y, testElements.panel.width, testElements.panel.height);
            fill(0);
            text(testElements.panel.label,
                testElements.panel.x + testElements.panel.width/2,
                testElements.panel.y + testElements.panel.height/2);
            
            // Status indicator
            fill(g_uiDebugManager.isActive ? color(0, 255, 0) : color(255, 0, 0));
            noStroke();
            ellipse(width - 30, 30, 20, 20);
            fill(255);
            textAlign(RIGHT, TOP);
            text(`Debug: ${g_uiDebugManager.isActive ? 'ON' : 'OFF'}`, width - 45, 22);
            
            // Render debug overlays
            g_uiDebugManager.render();
        }
        
        function keyPressed() {
            if (key === '~' || key === '`') {
                g_uiDebugManager.toggle();
            }
        }
        
        function mousePressed() {
            if (g_uiDebugManager.isActive) {
                const handled = g_uiDebugManager.handlePointerDown({ x: mouseX, y: mouseY });
                if (handled) return;
            }
        }
        
        function mouseDragged() {
            if (g_uiDebugManager.isActive) {
                g_uiDebugManager.handlePointerMove({ x: mouseX, y: mouseY });
            }
        }
        
        function mouseReleased() {
            if (g_uiDebugManager.isActive) {
                g_uiDebugManager.handlePointerUp({ x: mouseX, y: mouseY });
            }
        }
    </script>
</body>
</html>